<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Microservices Gateway Client App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script th:inline="javascript">
        let token = /*[[${idToken}]]*/ null;
        console.log("Injected token:", token);

        async function callApi() {
            const responseBox = document.getElementById('api-response');
            responseBox.textContent = 'Calling API...';
            try {
                const res = await fetch('http://localhost:1111/accounts/123456789', {
                    method: 'GET',
                    headers: token ? { 'Authorization': 'Bearer ' + token } : {}
                });
                if (!res.ok) {
                    const errorText = await res.text(); 
                    responseBox.textContent = `${res.status} ${res.statusText}\n${errorText}`;
                } else {
                    const text = await res.text();
                    responseBox.textContent = text;
                }
            } catch (err) {
                responseBox.textContent = 'Error: ' + err;
            }
        }
    </script>
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Microservices Gateway Client App</a>
        <div class="d-flex">
            <span th:if="${username != null}" class="navbar-text">
                User: <strong th:text="${username}"></strong>
            </span>
            <a th:if="${username == null}" th:href="@{/oauth2/authorization/google}" class="btn btn-light ms-2">
                Login with Google
            </a>
        </div>
    </div>
</nav>

<!-- Main Content -->
<div class="container d-flex flex-column align-items-center justify-content-center mt-5">
    <div class="input-group mb-3 w-50">
        <input type="text" class="form-control" value="GET /accounts/123456789" readonly>
        <button class="btn btn-primary" type="button" onclick="callApi()">Call API</button>
    </div>

    <div class="card w-50">
        <div class="card-body">
            <pre id="api-response" class="mb-0">API response will appear here...</pre>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
